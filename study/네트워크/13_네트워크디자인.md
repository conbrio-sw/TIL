## 13.1 2계층/3계층 네트워크

### 13.1.1 2계층 네트워크

- 호스트 간 통신이 직접 2계층 통신만으로 이루어지는 네트워크 디자인
  - 호스트가 동일한 네트워크여야한다.
  - 게이트웨이를 거치지 않는다.
- 하나의 브로드캐스트 도메인이 되고 루프 구조가 생기는 문제 발생
  - 스패닝 트리 프로토콜을 사용해 문제 해결
  - 스패닝 트리 프로토콜 사용으로 블록 포인트가 생기면서 전체 인프라의 대역폭을 사용하지 못하는 문제 발생
  - 논블록킹 구조를 만들어야 해결 가능
  - MC-LAG와 같은 기술을 이용해 루프를 제거하고, 논블로킹 구조를 구현 가능

### 13.1.2 3계층 네트워크

- 호스트 간 통신이 IP 라우팅과 같은 3계층 통신으로 이루어지는 네트워크 디자인
- 라우팅으로 구성된 네트워크 구조
  - 루프 문제 발생 X
  - 전체 네트워크 인프라의 대역폭을 ECMP (Equal-Cost Multi-Path) 라우팅 기술 이용해 모두 사용 가능
- 네트워크 장비 연결마다 다른 네트워크를 가지고
  - 네트워크에 연결되어 있는 단말도 다른 네트워크 장비에 연결되어 있다면, 다른 네트워크를 가지게 된다.
  - 브로드 캐스트로 상대방 호스트를 직접 찾을 수 없어 이런 형태의 통신이 필요하다면 3계층 기반 디자인 사용 X
- VxLAN과 같은 오버레이 네트워크 기술을 사용
  - 하단 호스트 간에 동일한 네트워크 사용하면서도
  - 네트워크 장비 간에 3계층 통신을 하도록 구성 가능
  - 이런 구성은 2계층 네트워크를 확장하면서도, 3계층의 장점인 루프 없이 전체 네트워크 대역폭을 모두 사용할 수 있게 함

## 13.2 3-Tier 아키텍쳐

- 코어 - 애그리게이션(Aggregation) - 엑세스 3계층으로 이루어진 네트워크 아키텍쳐
- 호스트가 직접 연결된 엑서스 계층에 스위치가 있고
  - 엑서스 스위치를 중간에서 집선하는 애그리게이션 스위치가 그 상단에 존재
  - 코어 계층 스위치는 애그리게이션 스위치를 다시 모아 서로 통신할 수 있게 해준다.
- 전통적인 데이터 센터와 일반적인 캠퍼스 네트워크 디자인 기법
  - 지금도 많이 사용
  - 상위 레이어로 올라갈수록 장비들이 집선되므로, 높은 대역폭 필요
  - 대역폭 확보하지 못하면 병목현상 발생할 수 있으므로
    - 각 레이어 상단과의 연결 구성된 업링크에서는 오버서브스크립션 비율을 잘 선정해 구성해야한다.
- 데이터 센터의 경우
  - 서버 간 통신보다, 사용자로부터 서비스를 요청 받고
  - 서버에서 사용자의 요청에 응답하는 North-South 트래픽이 대부분인 경우에 적합한 구조

## 13.3 2-Tier 아키텍쳐

- 스파인-리프구조
  - 몇 년 전부터 스파인-리프 2티어 디자인 기법이 데이터 센터 디자인으로 많이 적용
  - 하단 호스트가 연결되는 리프 스위치는 상단 스파인 스위치에 연결된다.
  - 리프 스위치와 스파인 스위치 간에는 전통적인 2계층 스패닝 트리가 동작하지 않고 모든 링크를 사용해 트래픽 전송
  - North-South라고 부르는 외부 사용자의 트래픽이 주 였던 과거와는 달리,
    - 대용량 분산처리 기술이 많이 사용되는 최근에는 데이터 센터 내부의 서버 간 통신량이 급증
    - 데이터 센터 내 계층이 복잡할 수록 East-West(서버 간 통신)이 많은 현대 네트워크에서는 네트워크 부하가 커지고, 성능 지연 발생
    - 이런 문제를 보완하기 위해 3계층 아키텍쳐에서 스파인-리프 아키텍쳐로 네트워크 디자인 기법이 변하고 있다.
  - 스파인-리프 네트워크 디자인에서는 동일 스위치에 호스트가 연결된 경우를 제외하면
    - 모든 호스트 간 통신 홉이 동일하다.
    - 출발지 리프 스위치를 지나 스파인 스위치를 거쳐, 목적지 리프 스위치로 트래픽이 흘러
    - 네트워크 흐름에 대한 홉 수가 짧아지고, ㅌ래픽 흐름이 일정해지는 장점이 있다.
  - East-West 증가 원인
    - 서버 가상화
      - 서버 호스트 하나에 다수의 가상 머신이 운영
      - 서버 가상화를 사용하면, 동일한 네트워크에 속한 서버들이 하나의 리프 스위치에 연결되지 않고 다양한 스위치에 연결된다.
      - 동일한 서비스를 위한 서버들의 통신이 바로 옆에서 연결되지 못하고 스파인을 거쳐 통신이 되어야한다.
      - 또한 가상 머신은 하나의 호스트 내에 지속적으로 있는 것이 아니라, 가상 머신 마이그레이션 기술을 이용해 이동하므로
      - 이 작업이 수해되면 대량의 트래픽이 데이터 센터 내에서 발생
    - 빅데이터 대중화
      - 빅테이터 기술들은 기본적으로 분산처리하므로, 컨트롤 노드와 데이터 저장 노드로 분리되어 있고
      - 이런 기능의 분리는 서버 간 통신이 많다는 특징이 있다.
      - 빅데이터에서 널리 쓰이는 하둡(Hadoop)은 동일한 데이터를 기본적으로 3카피(copy)해 데이터 노드에 저장하므로 대량의 트래픽이 데이터 센터에서 흐르게 된다.
    - 애플리케이션 아키텍쳐와 개발 방법의 변화
      - 마이크로 서비스 아키텍쳐와 같은 애플리케이션 아키텍쳐의 변화 방향은 클라이언트-서버 간 통신 뿐만 아니라, 서버 간 통신도 증가시킬 수 있다.
      - 기존 서버 한 대에서 다양한 서비스를 제공하던 것이, 다수의 단독 서비스로 분리되면서 서비스 간 내부 통신이 많아진다.
      - 이런 아키텍쳐는, 빈번한 배포가 가능한 VM, 컨테이너와 같은 유연한 인프라 기반으로 이루어지므로 데이터 센터 내 트래픽 증가를 가속화 가능

## 13.4 데이터 센터 Zone / PoD 내부망 / DMZ망 / 인터넷망

## 13.5 케이블링과 네트워크

### 13.5.1 ToR

- Top of Rack
- 랙 상단에 개별적으로 설치되는 스위치 구성
  - 일반적으로 각 랙 최상단에 ToR 스위치를 구성하고, 해당 랙에 있는 서버들을 연결
  - 랙 내에서 서버 집적도, 물리적 네트워크 분리, 이중화 요건에 따라 랙 내 스위치는 2대 이상이 될 수도 있고 
  - 반대로 랙 2개를 묶어 하나의 스위치로 관리 가능
  - 세부 구성과 상관없이 ToR 스위치는 랙 안에 설치된 서버들을 직접 연결하고
  - 상단 네트워크 장비는 별도의 네트워크 랙에 구성되어 서로 연결된다.
  - 결국 각 랙에 구성된 서버들은 해당 랙에 있는 ToR 스위치에 연결되고
  - ToR 스위치는 상단 네트워크 장비에 모두 연결되는 구성을 말한다.
- ToR 구성은 서버가 스위치와 동일한 랙에 있으므로 케이블링의 길이나 복잡성이 줄어든다.
  - ToR 구성은 EoR 구성보다 스위치가 더 많이 필요하므로 네트워크 장비에 대한 관리 사항이 늘어난다
  - 늘어난 스위치 수량 때문에 전력이나 냉각 비용도 따라 늘면서 전체적인 운영 비용 증가
  - 랙 별로 사전에 스위치를 구성해야하므로 미사용 중인 포트가 늘어 포트의 집적도가 떨어질 수 도 있다.

### 13.5.2 EoR

-  End of Row
- 랙이 있는 행 끝에 네트워크 장비를 두고 각 렉에 있는 서버는 네트워크 장비가 있는 랙까지 케이블로 연결
  - 즉 서버가 있는 랙과 네트워크 장비가 있는 랙을 분리한 구성
- EoR은 네트워크 장비 랙에서 케이블이 서버로 직접 구성되므로 각 랙마다 별도의 개별 스위치를  증설 X
  - 대형 새시(Chassis) 스위치에서 라인 카드를 추가하는 방식으로 포트 수 증가시킬 수 있어 ToR 보다 필요한 스위치 장비 수가 줄어든다.
  - 따라서 관리하는 장비 수와 통과하는 스위치 수가 줄어 대기 시간이나 지연에 유리
- 하지만, 서버와의 케이블 구성이 더 멀어지므로, 복잡도가 높아지고 케이블이 길어진다
  - 따라서 케이블 구축비용이 증가하고, 다음에 서버와 스위치 간 인터페이스를 업그레이드해야하는 경우 케이블 교체 비용 증가할 수도 있다.

### 13.5.3 MoR

- Middle of Row
- EoR과 유사, 단 끝이 아닌 중간에 네트워크 장비 랙 별도로 구성